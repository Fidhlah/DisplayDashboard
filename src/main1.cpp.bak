#include <Arduino.h>
#include <DHT.h>
#include <WiFi.h>
#include "include/Timer.h"
#include "include/DebugMacros.h"
#include "time.h"
#include <Wire.h>
#include <SPI.h>
#include <MD_Parola.h>
#include <MD_MAX72xx.h>
#include <SPI.h>
#include "include/DisplayManager.h"
#include "include/LogicManager.h"
#include <RTClib.h>

RTC_DS3231 rtc;
Timer RTCPrint(1000);
char daysOfTheWeek [7][12] = {"Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"};

void setup(){
  Serial.begin(115200);
  if (! rtc.begin()) {
    debugPrintln("Couldn't find RTC");
  }else{
    debugPrintln("RTC berhasil dimulai");
  }

  if (rtc.lostPower()) {
    debugPrintln("RTC lost power");
    rtc.adjust(DateTime(F(__DATE__), F(__TIME__)));
  }

}

void loop(){

  if(RTCPrint.isReady()){
    DateTime now = rtc.now();
  
    // Getting each time field in individual variables
    // And adding a leading zero when needed;
    String yearStr = String(now.year(), DEC);
    String monthStr = (now.month() < 10 ? "0" : "") + String(now.month(), DEC);
    String dayStr = (now.day() < 10 ? "0" : "") + String(now.day(), DEC);
    String hourStr = (now.hour() < 10 ? "0" : "") + String(now.hour(), DEC); 
    String minuteStr = (now.minute() < 10 ? "0" : "") + String(now.minute(), DEC);
    String secondStr = (now.second() < 10 ? "0" : "") + String(now.second(), DEC);
    String dayOfWeek = daysOfTheWeek[now.dayOfTheWeek()];

    // Complete time string
    String formattedTime = dayOfWeek + ", " + yearStr + "-" + monthStr + "-" + dayStr + " " + hourStr + ":" + minuteStr + ":" + secondStr;

    // Print the complete formatted time
    Serial.println(formattedTime);

    // Getting temperature
    Serial.print(rtc.getTemperature());
    Serial.println("ÂºC");

    Serial.println();
  }
}